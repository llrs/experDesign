---
title: "exprDesign"
author: "LluÃ­s Revilla Sancho"
date: "`r Sys.Date()`"
output:
  BiocStyle::html_document:
    fig_caption: true
    code_folding: show
    self_contained: yes
    toc_float:
      collapsed: true
      toc_depth: 3
vignette: >
  %\VignetteIndexEntry{exprDesign}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r knitsetup, message=FALSE, warning=FALSE, include=FALSE}
knitr::opts_knit$set(root.dir = ".")
knitr::opts_chunk$set(collapse = TRUE, warning = TRUE)
BiocStyle::markdown()
library("BiocStyle")
```

# Introduction

This package was developed to help prepare some samples to be send to a 
facility. It assumes that you have collected the samples and the information 
but you still need to do the experiment in several batches due to technical or 
practical limitations. 


# Previous work

Before building this package I would like to give credit to those that made 
also efforts in this direction:

The [OSAT](https://bioconductor.org/packages/OSAT/) package handles categorical 
variables but not numeric data.

The [minDiff](https://github.com/m-Py/minDiff) package reported in [Stats.SE](https://stats.stackexchange.com/a/326015/105234), handles both 
numeric and categorical data, but it can only optimize for two nominal criteria.


# Approach

Of all the space of possible combinations of samples, it looks for the
combination which minimizes the differences between each subgroup

 - If the variable is categorical it looks so that the entropy is closer to random.
 - If the variable is numeric it looks so that the distribution is closer to the original.
 - If there are `NA` (not available values) it looks to distribute them randomly.


# Preparation

We can use the survey dataset for the examples:
```{r}
library("MASS")
data(survey) 
head(survey)
```

The dataset has numeric, categorical values and some `NA`'s value.

# Workflow

Imagine that we can only work in groups of 70, and we want to randomize by Sex, 
Smoke, Age, and by writing hand.

```{r, fig.show='hold'}
# library("experDesign")
omit <- c("Wr.Hnd", "NW.Hnd", "Fold", "Pulse", "Clap", "Exer", "Height", "M.I")
index <- design(pheno = survey, size.batch = 70, omit = omit)
```
To convert to a value to append to the data.frame we can use:
```{r batch, eval=FALSE}
batch <- batch_names(index)
```

Or if we want to do so automatically we can do:
```{r}
df <- inspect(index, survey, omit = omit)
head(df)
```

If a data.frame has a column with name "batch" we can use the function 
distribution to see if it is randomlly distriubted. Or we can see the mean 
difference between each subgroup and the original value of the data.frame.

```{r}
evaluate_entropy(index, survey)
evaluate_independence(index, survey)

evaluate_na(index, survey)

evaluate_mean(index, survey)
evaluate_sd(index, survey)
evaluate_mad(index, survey)
```

The numbers provided are just an indicator of how far are they from a perfect 
distance. The farthest and index is, the worst it is to account for batch effect.


# SessionInfo

```{r}
sessionInfo()
```

