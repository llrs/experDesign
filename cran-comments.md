This resubmission fixes some bugs and speed increase on some functions

## Test environments

* local R installation, R 3.6.3 and 4.0.1
* ubuntu 16.04 (on travis-ci), old-release, release, devel
* win-builder, old-release, release, devel
* Github Actions (windows), release
* Github Actions (macOS), release
* Github Actions Ubuntu 20.04, release and devel

## R CMD check results

0 errors | 0 warnings | 0 note

## Dependencies

No dependencies
