<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Design experiments for batches â€¢ experDesign</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Design experiments for batches">
<meta property="og:description" content="Distributes samples in batches while making batches homogeneous according to their description. Allows for an arbitrary number of variables, both numeric and categorical. For quality control it provides functions to subset a representative sample.">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@Lluis_Rev">
<meta name="twitter:site" content="@Lluis_Rev">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">experDesign</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/experdesign.html">exprDesign</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/llrs/experDesign/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="experdesign" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#experdesign" class="anchor"></a>experDesign</h1></div>
<!-- badges: start -->

<p>The goal of experDesign is to help you decide which samples go in which batch, reducing the potential batch bias when analyzing.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>To install the latest version on <a href="https://CRAN.R-project.org/package=experDesign">CRAN</a> use:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"experDesign"</span><span class="op">)</span></pre></div>
<p>You can install the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"llrs/experDesign"</span><span class="op">)</span></pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Imagine you have some samples already collected and you want to distributed them in batches:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/llrs/experDesign">"experDesign"</a></span><span class="op">)</span>
<span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">5</span><span class="op">)</span>, 
                        weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">300</span>, <span class="fl">50</span><span class="op">)</span>,
                        sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Male"</span>,<span class="st">"Female"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">metadata</span>, <span class="fl">15</span><span class="op">)</span>
<span class="co">#&gt;    height weight  sex</span>
<span class="co">#&gt; 1      60    100 Male</span>
<span class="co">#&gt; 2      65    100 Male</span>
<span class="co">#&gt; 3      70    100 Male</span>
<span class="co">#&gt; 4      75    100 Male</span>
<span class="co">#&gt; 5      80    100 Male</span>
<span class="co">#&gt; 6      60    150 Male</span>
<span class="co">#&gt; 7      65    150 Male</span>
<span class="co">#&gt; 8      70    150 Male</span>
<span class="co">#&gt; 9      75    150 Male</span>
<span class="co">#&gt; 10     80    150 Male</span>
<span class="co">#&gt; 11     60    200 Male</span>
<span class="co">#&gt; 12     65    200 Male</span>
<span class="co">#&gt; 13     70    200 Male</span>
<span class="co">#&gt; 14     75    200 Male</span>
<span class="co">#&gt; 15     80    200 Male</span></pre></div>
<p>If you block incorrectly and end up with a group in a single batch we will end up with batch effect. In order to avoid this <code>design</code> helps you assign each sample to a batch (in this case each batch has 24 samples at most). First we can explore the number of samples and the number of batches:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">size_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span>
<span class="va">size_batch</span> <span class="op">&lt;-</span> <span class="fl">24</span>
<span class="op">(</span><span class="va">batches</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/optimum.html">optimum_batches</a></span><span class="op">(</span><span class="va">size_data</span>, <span class="va">size_batch</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 3</span>
<span class="co"># So now the best number of samples for each batch is less than the available</span>
<span class="op">(</span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/optimum.html">optimum_subset</a></span><span class="op">(</span><span class="va">size_data</span>, <span class="va">batches</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 17</span>
<span class="co"># The distribution of samples per batch</span>
<span class="fu"><a href="reference/optimum.html">sizes_batches</a></span><span class="op">(</span><span class="va">size_data</span>, <span class="va">size</span>, <span class="va">batches</span><span class="op">)</span>
<span class="co">#&gt; [1] 17 17 16</span></pre></div>
<p>Note that instead of using a whole batch and then leave a single sample on the third distributes all the samples in the three batches that will be needed. We can directly look for the distribution of the samples given our max number of samples per batch:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/design.html">design</a></span><span class="op">(</span><span class="va">metadata</span>, <span class="va">size_batch</span><span class="op">)</span>
<span class="co"># It is a list but we can convert it to a vector with:</span>
<span class="fu"><a href="reference/batch_names.html">batch_names</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>
<span class="co">#&gt;  [1] "SubSet3" "SubSet2" "SubSet2" "SubSet1" "SubSet3" "SubSet2" "SubSet1"</span>
<span class="co">#&gt;  [8] "SubSet1" "SubSet2" "SubSet2" "SubSet1" "SubSet2" "SubSet1" "SubSet3"</span>
<span class="co">#&gt; [15] "SubSet1" "SubSet3" "SubSet2" "SubSet1" "SubSet3" "SubSet1" "SubSet2"</span>
<span class="co">#&gt; [22] "SubSet1" "SubSet3" "SubSet2" "SubSet1" "SubSet1" "SubSet1" "SubSet1"</span>
<span class="co">#&gt; [29] "SubSet3" "SubSet2" "SubSet3" "SubSet2" "SubSet3" "SubSet3" "SubSet2"</span>
<span class="co">#&gt; [36] "SubSet1" "SubSet2" "SubSet1" "SubSet3" "SubSet3" "SubSet2" "SubSet3"</span>
<span class="co">#&gt; [43] "SubSet2" "SubSet3" "SubSet3" "SubSet1" "SubSet1" "SubSet2" "SubSet2"</span>
<span class="co">#&gt; [50] "SubSet3"</span></pre></div>
<p>Naively one would either fill some batches fully or distribute them not evenly (the first 17 packages together, the next 17 and so on). This solution ensures that the data is randomized. For more random distribution you can increase the number of iterations performed to calculate this distribution.</p>
<p>If you need space for replicates to control for batch effect you can use:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/replicates.html">replicates</a></span><span class="op">(</span><span class="va">metadata</span>, <span class="va">size_batch</span>, <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>
<span class="co">#&gt; SubSet1 SubSet2 SubSet3 </span>
<span class="co">#&gt;      20      20      20</span>
<span class="va">r</span>
<span class="co">#&gt; $SubSet1</span>
<span class="co">#&gt;  [1]  4  9 10 12 20 21 22 23 25 26 28 29 31 39 40 41 43 45 49 50</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $SubSet2</span>
<span class="co">#&gt;  [1]  2  7 13 15 16 18 21 23 24 27 30 33 35 36 37 38 41 47 49 50</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $SubSet3</span>
<span class="co">#&gt;  [1]  1  3  5  6  8 11 14 17 19 21 23 32 34 41 42 44 46 48 49 50</span></pre></div>
<p>Which seeks as controls the most diverse values and adds them to the samples distribution. Note that if the sample is already present on that batch is not added again, thatâ€™s why the number of samples per batch is different from the design without replicates.</p>
</div>
</div>
<div id="previous-work" class="section level1">
<h1 class="hasAnchor">
<a href="#previous-work" class="anchor"></a>Previous work</h1>
<p>The CRAN task View of <a href="https://CRAN.R-project.org/view=ExperimentalDesign">Experimental Design</a> includes many packages relevant for designing an experiment before collecting data, but none of them provides how to manage them once the samples are already collected.</p>
<p>Two packages allow to distribute the samples on batches:</p>
<ul>
<li><p>The <a href="https://bioconductor.org/packages/release/bioc/html/OSAT.html">OSAT</a> package handles categorical variables but not numeric data. It doesnâ€™t work with our data.</p></li>
<li><p>The <a href="https://github.com/m-Py/minDiff">minDiff</a> package reported in <a href="https://stats.stackexchange.com/a/326015/105234">Stats.SE</a>, handles both numeric and categorical data. But it can only optimize for two nominal criteria. It doesnâ€™t work for our data.</p></li>
</ul>
<p>If you are still designing the experiment and do not have collected any data <a href="https://cran.r-project.org/package=DeclareDesign">DeclareDesign</a> might be relevant for you.</p>
<p>Question in <a href="https://bioinformatics.stackexchange.com/q/4765/48">Bioinformatics.SE</a> I made before developing the package.</p>
</div>
<div id="other" class="section level1">
<h1 class="hasAnchor">
<a href="#other" class="anchor"></a>Other</h1>
<p>Please note that this project is released with a <a href="https://www.contributor-covenant.org/version/1/0/0/code-of-conduct/">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=experDesign">https://â€‹cloud.r-project.org/â€‹package=experDesign</a>
</li>
<li>Browse source code at <br><a href="https://github.com/llrs/experDesign/">https://â€‹github.com/â€‹llrs/â€‹experDesign/â€‹</a>
</li>
<li>Report a bug at <br><a href="https://github.com/llrs/experDesign/issues">https://â€‹github.com/â€‹llrs/â€‹experDesign/â€‹issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>LluÃ­s Revilla Sancho <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-9747-2570" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://CRAN.R-project.org/package=experDesign"><img src="https://www.r-pkg.org/badges/version/experDesign" alt="CRAN status"></a></li>
<li><a href="https://github.com/llrs/experDesign/actions?workflow=R-CMD-check"><img src="https://github.com/llrs/experDesign/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
<li><a href="https://ci.appveyor.com/project/llrs/experDesign"><img src="https://ci.appveyor.com/api/projects/status/github/llrs/experDesign?branch=master&amp;svg=true" alt="AppVeyor build status"></a></li>
<li><a href="https://travis-ci.org/llrs/experDesign"><img src="https://travis-ci.org/llrs/experDesign.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://codecov.io/github/llrs/experDesign?branch=master"><img src="https://codecov.io/gh/llrs/experDesign/branch/master/graph/badge.svg" alt="Coverage status"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#stable"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a></li>
<li><a href="https://www.repostatus.org/#active"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active - The project has reached a stable, usable state and is being actively developed."></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by LluÃ­s Revilla Sancho.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
