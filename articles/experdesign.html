<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="experDesign">
<title>exprDesign • experDesign</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="exprDesign">
<meta property="og:description" content="experDesign">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@Lluis_Revilla">
<meta name="twitter:site" content="@Lluis_Revilla">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">experDesign</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/experdesign.html">exprDesign</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/llrs/experDesign/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>exprDesign</h1>
                        <h4 data-toc-skip class="author">Lluís Revilla Sancho</h4>
            
            <h4 data-toc-skip class="date">2022-02-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/llrs/experDesign/blob/HEAD/vignettes/experdesign.Rmd" class="external-link"><code>vignettes/experdesign.Rmd</code></a></small>
      <div class="d-none name"><code>experdesign.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This package was developed to help prepare some samples to be send to a facility. It assumes that you have collected the samples and the information but you still need to do the experiment in several batches due to technical or practical limitations. The question that tries to answer is:</p>
<blockquote>
<p>Which samples go with each batch?</p>
</blockquote>
<p>Of all the possible combinations of samples, it looks for the combination which minimizes the differences between each subgroup according to the following rules:</p>
<ul>
<li>If the variable is categorical it tires to randomize the variable across the subgroups.</li>
<li>If the variable is numeric it tries to distribute evenly following the original distribution of values.</li>
<li>If there are <code>NA</code> (not available values) it looks to distribute them randomly.</li>
</ul>
<p>Even with this measures you might end up with some batch effect due to: - Confounding variables not provided for their randomization on the batches Sometimes due to being unknown, impossible to measure. - Lack of <a href="https://en.wikipedia.org/wiki/Replication_(statistics)" class="external-link">replicates</a>(samples with the same conditions) If you can’t provide new replicates, aim to provide more technical replicates. Technical replicates mean reanalyzing the same sample twice or more, the more samples with technical replicates the more accurate your measures will be and easier to avoid or detect batch effects. - Processing If there is a change on the methodology, or you pause and resume later the sample collection there might be changes on the outcome due to external factors.</p>
</div>
<div class="section level2">
<h2 id="previous-work">Previous work<a class="anchor" aria-label="anchor" href="#previous-work"></a>
</h2>
<p>Before building this package I would like to give credit to those that made also efforts in this direction:</p>
<p>The CRAN task View of <a href="https://CRAN.R-project.org/view=ExperimentalDesign" class="external-link">Experimental Design</a> includes many packages relevant for designing an experiment before collecting data, but none of them provides how to manage them once the samples are already collected.</p>
<p>Two packages allow to distribute the samples on batches:</p>
<ul>
<li><p>The <a href="https://bioconductor.org/packages/release/bioc/html/OSAT.html" class="external-link">OSAT</a> package handles categorical variables but not numeric data. It doesn’t work with our data.</p></li>
<li><p>The <a href="https://github.com/m-Py/minDiff" class="external-link">minDiff</a> package reported in <a href="https://stats.stackexchange.com/a/326015/105234" class="external-link">Stats.SE</a>, handles both numeric and categorical data. But it can only optimize for two nominal criteria. It doesn’t work for our data.</p></li>
<li><p>The <a href="https://bioconductor.org/packages/Omixer/" class="external-link">Omixer</a> package handles both numeric and categorical data (converting categorical variables to numeric). But both the same way either Pearson’s Chi-squared Test if there are few samples or Kendall’s correlation. It does allow to protect some spots from being used.</p></li>
</ul>
<p>If you are still designing the experiment and do not have collected any data <a href="https://cran.r-project.org/package=DeclareDesign" class="external-link">DeclareDesign</a> might be relevant for you.</p>
<p>Question in <a href="https://bioinformatics.stackexchange.com/q/4765/48" class="external-link">Bioinformatics.SE</a> I made before developing the package.</p>
</div>
<div class="section level2">
<h2 id="DoE">Design of Experiment<a class="anchor" aria-label="anchor" href="#DoE"></a>
</h2>
<p>Imagine you have some samples already collected and you want to distributed them in batches:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://experdesign.llrs.dev">"experDesign"</a></span><span class="op">)</span>
<span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">5</span><span class="op">)</span>, 
                        weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">300</span>, <span class="fl">50</span><span class="op">)</span>,
                        sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>,<span class="st">"Female"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">metadata</span>, <span class="fl">15</span><span class="op">)</span>
<span class="co">##    height weight  sex</span>
<span class="co">## 1      60    100 Male</span>
<span class="co">## 2      65    100 Male</span>
<span class="co">## 3      70    100 Male</span>
<span class="co">## 4      75    100 Male</span>
<span class="co">## 5      80    100 Male</span>
<span class="co">## 6      60    150 Male</span>
<span class="co">## 7      65    150 Male</span>
<span class="co">## 8      70    150 Male</span>
<span class="co">## 9      75    150 Male</span>
<span class="co">## 10     80    150 Male</span>
<span class="co">## 11     60    200 Male</span>
<span class="co">## 12     65    200 Male</span>
<span class="co">## 13     70    200 Male</span>
<span class="co">## 14     75    200 Male</span>
<span class="co">## 15     80    200 Male</span></code></pre></div>
<p>If you block incorrectly and end up with a group in a single batch we will end up with batch effect. In order to avoid this <code><a href="../reference/design.html">design()</a></code> helps you assign each sample to a batch (in this case each batch has 24 samples at most). First we can explore the number of samples and the number of batches:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">size_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span>
<span class="va">size_batch</span> <span class="op">&lt;-</span> <span class="fl">24</span>
<span class="op">(</span><span class="va">batches</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimum.html">optimum_batches</a></span><span class="op">(</span><span class="va">size_data</span>, <span class="va">size_batch</span><span class="op">)</span><span class="op">)</span>
<span class="co">## [1] 3</span>
<span class="co"># So now the best number of samples for each batch is less than the available</span>
<span class="op">(</span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimum.html">optimum_subset</a></span><span class="op">(</span><span class="va">size_data</span>, <span class="va">batches</span><span class="op">)</span><span class="op">)</span>
<span class="co">## [1] 17</span>
<span class="co"># The distribution of samples per batch</span>
<span class="fu"><a href="../reference/optimum.html">sizes_batches</a></span><span class="op">(</span><span class="va">size_data</span>, <span class="va">size</span>, <span class="va">batches</span><span class="op">)</span>
<span class="co">## [1] 17 17 16</span></code></pre></div>
<p>Note that instead of using a whole batch and then leave a single sample on the third distributes all the samples in the three batches that will be needed.</p>
</div>
<div class="section level2">
<h2 id="randomization">Randomization<a class="anchor" aria-label="anchor" href="#randomization"></a>
</h2>
<p>We can directly look for the distribution of the samples given our max number of samples per batch:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span><span class="va">metadata</span>, <span class="va">size_batch</span><span class="op">)</span>
<span class="co"># It is a list but we can convert it to a vector with:</span>
<span class="fu"><a href="../reference/batch_names.html">batch_names</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>
<span class="co">##  [1] "SubSet2" "SubSet2" "SubSet1" "SubSet2" "SubSet1" "SubSet1" "SubSet1"</span>
<span class="co">##  [8] "SubSet1" "SubSet3" "SubSet3" "SubSet3" "SubSet2" "SubSet1" "SubSet3"</span>
<span class="co">## [15] "SubSet2" "SubSet3" "SubSet2" "SubSet2" "SubSet2" "SubSet2" "SubSet1"</span>
<span class="co">## [22] "SubSet3" "SubSet3" "SubSet1" "SubSet2" "SubSet3" "SubSet3" "SubSet2"</span>
<span class="co">## [29] "SubSet3" "SubSet2" "SubSet1" "SubSet1" "SubSet1" "SubSet1" "SubSet3"</span>
<span class="co">## [36] "SubSet1" "SubSet1" "SubSet3" "SubSet3" "SubSet2" "SubSet2" "SubSet2"</span>
<span class="co">## [43] "SubSet3" "SubSet3" "SubSet2" "SubSet3" "SubSet2" "SubSet1" "SubSet1"</span>
<span class="co">## [50] "SubSet1"</span></code></pre></div>
<p>Naively one would either fill some batches fully or distribute them not evenly (the first 17 packages together, the next 17 and so on). This solution ensures that the data is randomized. For more random distribution you can increase the number of iterations performed to calculate this distribution.</p>
</div>
<div class="section level2">
<h2 id="randomization-and-replicates">Randomization and replicates<a class="anchor" aria-label="anchor" href="#randomization-and-replicates"></a>
</h2>
<p>If you need space for replicates to control for batch effect you can use:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/replicates.html">replicates</a></span><span class="op">(</span><span class="va">metadata</span>, <span class="va">size_batch</span>, <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>
<span class="co">## SubSet1 SubSet2 SubSet3 </span>
<span class="co">##      21      21      18</span>
<span class="va">r</span>
<span class="co">## $SubSet1</span>
<span class="co">##  [1]  3  9 10 16 17 20 27 28 30 31 32 33 34 35 40 41 42 44 45 48 49</span>
<span class="co">## </span>
<span class="co">## $SubSet2</span>
<span class="co">##  [1]  4  5  7  8  9 10 13 15 18 21 22 25 26 32 33 34 36 37 38 39 47</span>
<span class="co">## </span>
<span class="co">## $SubSet3</span>
<span class="co">##  [1]  1  2  6  9 10 11 12 14 19 23 24 29 32 33 34 43 46 50</span></code></pre></div>
<p>Which seeks as controls the most diverse values and adds them to the samples distribution. Note that if the sample is already present on that batch is not added again, that’s why the number of samples per batch is different from the design without replicates.</p>
</div>
<div class="section level2">
<h2 id="layout">Layout<a class="anchor" aria-label="anchor" href="#layout"></a>
</h2>
<p>Lastly, we can see how these samples would be distributed in a layout of 6x4:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatial.html">spatial</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">metadata</span>, rows <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, columns <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>
<span class="co">## $A1</span>
<span class="co">## [1] 33 48 24</span>
<span class="co">## </span>
<span class="co">## $B1</span>
<span class="co">## [1] 15 22 39</span>
<span class="co">## </span>
<span class="co">## $C1</span>
<span class="co">## [1] 40  5 32</span>
<span class="co">## </span>
<span class="co">## $D1</span>
<span class="co">## [1]  3  9 41</span>
<span class="co">## </span>
<span class="co">## $E1</span>
<span class="co">## [1] 28 10 50</span>
<span class="co">## </span>
<span class="co">## $F1</span>
<span class="co">## [1]  4 13 29</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="report-for-easy-on-field-usage">Report for easy on field usage<a class="anchor" aria-label="anchor" href="#report-for-easy-on-field-usage"></a>
</h2>
<p>We can add the batches to the initial data with <code><a href="../reference/inspect.html">inspect()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">report</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">metadata</span><span class="op">)</span>
<span class="va">report2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">report</span>, index_name <span class="op">=</span> <span class="st">"position"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">report2</span><span class="op">)</span>
<span class="co">##   height weight  sex   batch position</span>
<span class="co">## 1     60    100 Male SubSet3       C2</span>
<span class="co">## 2     65    100 Male SubSet3       D2</span>
<span class="co">## 3     70    100 Male SubSet1       D1</span>
<span class="co">## 4     75    100 Male SubSet2       F1</span>
<span class="co">## 5     80    100 Male SubSet2       C1</span>
<span class="co">## 6     60    150 Male SubSet3       C4</span></code></pre></div>
<p>And now we can see the batch and position of each sample</p>
</div>
<div class="section level2">
<h2 id="unbalanced-setting">Unbalanced setting<a class="anchor" aria-label="anchor" href="#unbalanced-setting"></a>
</h2>
<p>In the previous case the data was mostly balanced (check it out in the <code>orig</code> object) but let’s create an unbalanced dataset to check it.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">99</span>
<span class="va">samples</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">unbalanced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Classroom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">samples</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,
                         Sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="va">samples</span><span class="op">-</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,
                         Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">samples</span>, mean <span class="op">=</span> <span class="fl">25</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">unbalanced</span><span class="op">)</span><span class="op">[</span>, , <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>
<span class="co">## , , Age = 17.8386553280725</span>
<span class="co">## </span>
<span class="co">##          Sex</span>
<span class="co">## Classroom F M</span>
<span class="co">##         A 0 0</span>
<span class="co">##         B 0 1</span>
<span class="co">## </span>
<span class="co">## , , Age = 19.7652909098992</span>
<span class="co">## </span>
<span class="co">##          Sex</span>
<span class="co">## Classroom F M</span>
<span class="co">##         A 0 0</span>
<span class="co">##         B 0 1</span>
<span class="co">## </span>
<span class="co">## , , Age = 20.0141867569824</span>
<span class="co">## </span>
<span class="co">##          Sex</span>
<span class="co">## Classroom F M</span>
<span class="co">##         A 0 1</span>
<span class="co">##         B 0 0</span>
<span class="co">## </span>
<span class="co">## , , Age = 20.4317639136216</span>
<span class="co">## </span>
<span class="co">##          Sex</span>
<span class="co">## Classroom F M</span>
<span class="co">##         A 0 0</span>
<span class="co">##         B 0 1</span>
<span class="co">## </span>
<span class="co">## , , Age = 20.8002586118616</span>
<span class="co">## </span>
<span class="co">##          Sex</span>
<span class="co">## Classroom F M</span>
<span class="co">##         A 0 1</span>
<span class="co">##         B 0 0</span></code></pre></div>
<p>In this dataset the classroom a single classroom has all the females (-49).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span><span class="va">unbalanced</span>, <span class="fl">15</span><span class="op">)</span>

<span class="co"># Mean entropy en each subset</span>
<span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="../reference/evaluate_index.html">evaluate_index</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">unbalanced</span><span class="op">)</span><span class="op">[</span><span class="st">"entropy"</span>, , <span class="op">]</span><span class="op">)</span>
<span class="co">##  Classroom        Sex        Age </span>
<span class="co">## 0.95647606 0.05303319 0.00000000</span>
<span class="co"># Original entropy on the dataset</span>
<span class="fu"><a href="../reference/evaluate_orig.html">evaluate_orig</a></span><span class="op">(</span><span class="va">unbalanced</span><span class="op">)</span><span class="op">[</span><span class="st">"entropy"</span>, <span class="op">]</span>
<span class="co">##  Classroom        Sex        Age </span>
<span class="co">## 1.00000000 0.08079314 0.00000000</span>
<span class="co"># Dispersion of the entropy</span>
<span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="../reference/evaluate_index.html">evaluate_index</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">unbalanced</span><span class="op">)</span><span class="op">[</span><span class="st">"entropy"</span>, , <span class="op">]</span>, <span class="fl">1</span>, <span class="va">sd</span><span class="op">)</span>
<span class="co">##  Classroom        Sex        Age </span>
<span class="co">## 0.02936726 0.14031263 0.00000000</span></code></pre></div>
<p>We can see that in this simple case where a single variable has all the other cases we approximately reached the same entropy levels.</p>
</div>
<div class="section level2">
<h2 id="quality-check">Quality check<a class="anchor" aria-label="anchor" href="#quality-check"></a>
</h2>
<p>If you need a subset with the samples that are more diverse you can use the following function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">survey</span>, package <span class="op">=</span> <span class="st">"MASS"</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">survey</span><span class="op">)</span>
<span class="co">##      Sex Wr.Hnd NW.Hnd W.Hnd    Fold Pulse    Clap Exer Smoke Height      M.I</span>
<span class="co">## 1 Female   18.5   18.0 Right  R on L    92    Left Some Never 173.00   Metric</span>
<span class="co">## 2   Male   19.5   20.5  Left  R on L   104    Left None Regul 177.80 Imperial</span>
<span class="co">## 3   Male   18.0   13.3 Right  L on R    87 Neither None Occas     NA     &lt;NA&gt;</span>
<span class="co">## 4   Male   18.8   18.9 Right  R on L    NA Neither None Never 160.00   Metric</span>
<span class="co">## 5   Male   20.0   20.0 Right Neither    35   Right Some Never 165.00   Metric</span>
<span class="co">## 6 Female   18.0   17.7 Right  L on R    64   Right Some Never 172.72 Imperial</span>
<span class="co">##      Age</span>
<span class="co">## 1 18.250</span>
<span class="co">## 2 17.583</span>
<span class="co">## 3 16.917</span>
<span class="co">## 4 20.333</span>
<span class="co">## 5 23.667</span>
<span class="co">## 6 21.000</span>
<span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extreme_cases.html">extreme_cases</a></span><span class="op">(</span><span class="va">survey</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">survey</span><span class="op">[</span><span class="va">samples</span>, <span class="op">]</span>
<span class="co">##        Sex Wr.Hnd NW.Hnd W.Hnd    Fold Pulse    Clap Exer Smoke Height      M.I</span>
<span class="co">## 5     Male   20.0   20.0 Right Neither    35   Right Some Never 165.00   Metric</span>
<span class="co">## 48    Male   22.5   23.0 Right  R on L    96   Right None Never 170.00   Metric</span>
<span class="co">## 60    Male   20.6   21.0  Left  L on R    NA    Left Freq Occas 175.26 Imperial</span>
<span class="co">## 66    Male   19.5   19.8 Right Neither    NA   Right Freq Never 183.00   Metric</span>
<span class="co">## 80    Male   20.0   20.5 Right  L on R    NA   Right Freq Never 185.42 Imperial</span>
<span class="co">## 83  Female   17.5   17.5 Right  R on L    98    Left Freq Never     NA     &lt;NA&gt;</span>
<span class="co">## 121   Male   20.0   20.0 Right  R on L    80 Neither Freq Occas     NA     &lt;NA&gt;</span>
<span class="co">## 154   Male   21.5   21.6 Right  R on L    69   Right Freq Never 172.72 Imperial</span>
<span class="co">## 170   Male   19.0   18.5 Right  R on L    72   Right Freq Never 180.34 Imperial</span>
<span class="co">## 225 Female   17.6   17.2 Right  L on R    NA   Right Some Never     NA     &lt;NA&gt;</span>
<span class="co">##        Age</span>
<span class="co">## 5   23.667</span>
<span class="co">## 48  19.417</span>
<span class="co">## 60  18.417</span>
<span class="co">## 66  18.000</span>
<span class="co">## 80  18.750</span>
<span class="co">## 83  17.667</span>
<span class="co">## 121 17.500</span>
<span class="co">## 154 70.417</span>
<span class="co">## 170 17.333</span>
<span class="co">## 225 19.917</span></code></pre></div>
<p>You can also test a given index with <code><a href="../reference/check_index.html">check_index()</a></code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/check_index.html">check_index</a></span><span class="op">(</span><span class="va">unbalanced</span>, <span class="va">i</span><span class="op">)</span>
<span class="co">##            subgroups</span>
<span class="co">##                SubSet1    SubSet2     SubSet3    SubSet4    SubSet5    SubSet6</span>
<span class="co">##   Classroom 0.03217261 0.01462103 0.009861847 0.02484257 0.02484257 0.02484257</span>
<span class="co">##   Sex       0.16047517 0.16047517 0.160475171 0.16047517 0.16047517 0.23035719</span>
<span class="co">##   Age       0.22558858 0.30829038 0.694147585 0.23040791 0.21351942 0.23255990</span>
<span class="co">##            subgroups</span>
<span class="co">##                 SubSet7</span>
<span class="co">##   Classroom 0.004937892</span>
<span class="co">##   Sex       0.160475171</span>
<span class="co">##   Age       0.323870366</span></code></pre></div>
<p>Each row has information about how accurate is a given variable to the samples available (on this case <code>unbalanced</code>). Some variables are distributed more randomly than others on this index.</p>
<p>If we are not satisfied we could <code><a href="../reference/design.html">design()</a></code> a new index increasing the iterations to obtain a potentially better distribution. If you want a good stratified randomization you should increase the iterations used 10 fold.</p>
</div>
<div class="section level2">
<h2 id="sessioninfo">SessionInfo<a class="anchor" aria-label="anchor" href="#sessioninfo"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## R version 4.1.2 (2021-11-01)</span>
<span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">## Running under: Ubuntu 20.04.3 LTS</span>
<span class="co">## </span>
<span class="co">## Matrix products: default</span>
<span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0</span>
<span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0</span>
<span class="co">## </span>
<span class="co">## locale:</span>
<span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span>
<span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span>
<span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span>
<span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span>
<span class="co">## </span>
<span class="co">## attached base packages:</span>
<span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">## </span>
<span class="co">## other attached packages:</span>
<span class="co">## [1] experDesign_0.1.1</span>
<span class="co">## </span>
<span class="co">## loaded via a namespace (and not attached):</span>
<span class="co">##  [1] knitr_1.37        magrittr_2.0.2    R6_2.5.1          ragg_1.2.1       </span>
<span class="co">##  [5] rlang_1.0.1       fastmap_1.1.0     stringr_1.4.0     tools_4.1.2      </span>
<span class="co">##  [9] xfun_0.29         cli_3.1.1         jquerylib_0.1.4   htmltools_0.5.2  </span>
<span class="co">## [13] systemfonts_1.0.4 yaml_2.2.2        digest_0.6.29     rprojroot_2.0.2  </span>
<span class="co">## [17] pkgdown_2.0.2     crayon_1.4.2      textshaping_0.3.6 purrr_0.3.4      </span>
<span class="co">## [21] sass_0.4.0        fs_1.5.2          memoise_2.0.1     cachem_1.0.6     </span>
<span class="co">## [25] evaluate_0.14     rmarkdown_2.11    stringi_1.7.6     compiler_4.1.2   </span>
<span class="co">## [29] bslib_0.3.1       desc_1.4.0        jsonlite_1.7.3</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lluís Revilla Sancho.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
